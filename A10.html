<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Chikankari Kurti - Mor</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link rel="stylesheet" href="mor.css">
</head>
<body>
    <!-- You can include your header here if you want it on every product page -->
    <header class="header">
        <nav class="nav">
            <button class="hamburger-menu" aria-label="Open Menu"><i class="fas fa-bars"></i></button>
            <a href="index.html" class="logo"><img src="logo.jpg" alt="Mor Logo" class="logo-img" loading="lazy"></a>
            <div class="nav-links-container">
                <button class="close-menu" aria-label="Close Menu"><i class="fas fa-times"></i></button>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="index.html#collections">Collections</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <li class="mobile-only-link"><button class="nav-link-button" id="mobile-login-link"><i class="fas fa-user"></i> Login</button></li>
                    <li class="mobile-only-link"><button class="nav-link-button" id="mobile-favorites-link"><i class="fas fa-heart"></i> Favorites</button></li>
                </ul>
            </div>
             <div class="nav-actions">
                <a href="login.html" class="login-btn" aria-label="Login">
                    <i class="fas fa-user"></i>
                </a>
            </div>
        </nav>
    </header>

    <main style="margin-top: 65px;">
        <div class="product-page-container beautiful-product-page" data-img-src="A10.jpg">
            <div class="product-gallery animate-slide-in-left">
                <div class="gallery-slider-container beautiful-gallery-main">
                    <div class="gallery-slider-track" id="gallery-slider-track">
                        <!-- Images will be injected by JS -->
                    </div>
                    <button class="gallery-arrow prev" id="gallery-prev" aria-label="Previous Image">&#10094;</button>
                    <button class="gallery-arrow next" id="gallery-next" aria-label="Next Image">&#10095;</button>
                    <div class="zoom-icon" id="zoom-icon"><i class="fas fa-search-plus"></i></div>
                </div>
                <div class="gallery-dots-container animate-fade-in" id="gallery-dots-container" style="transition-delay: 0.2s;"></div>
            </div>
            <div class="product-details animate-slide-in-right beautiful-product-details">
                <h1 id="product-name" class="animate-fade-in beautiful-product-title" style="transition-delay: 0.1s;">Black Chikankari Kurti</h1>
                <div class="product-price-container animate-fade-in beautiful-price-container" style="transition-delay: 0.2s;">
                    <p class="product-price" id="product-price">₹1,499</p>
                    <p class="product-old-price">₹1,999</p>
                    <p class="product-save-amount">Save ₹500</p>
                </div>
                <div class="product-options animate-fade-in beautiful-product-options" style="transition-delay: 0.3s;">
                    <div class="option-group beautiful-option-group">
                        <label for="size-selector">Select Size:</label>
                        <div class="size-selector" id="size-selector">
                            <button class="size-btn active">S</button>
                            <button class="size-btn">M</button>
                            <button class="size-btn">L</button>
                            <button class="size-btn">XL</button>
                        </div>
                    </div>
                    <div class="option-group beautiful-option-group">
                        <label for="quantity-counter">Quantity:</label>
                        <div class="quantity-counter" id="quantity-counter">
                            <button class="quantity-btn" data-action="decrease">-</button>
                            <span class="quantity-value">1</span>
                            <button class="quantity-btn" data-action="increase">+</button>
                        </div>
                    </div>
                </div>
                <div class="product-actions animate-fade-in beautiful-product-actions" style="transition-delay: 0.4s;">
                    <button class="cta-btn add-to-cart-btn beautiful-add-to-cart" id="add-to-cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</button>
                </div>
                <!-- New Modern Accordion -->
                <div class="modern-accordion-container animate-fade-in" style="transition-delay: 0.5s;">
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">Description<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p>Embrace timeless elegance with this stunning Black Chikankari Kurti. Hand-embroidered with intricate floral patterns, this piece is a testament to traditional craftsmanship. Made from pure, breathable cotton, it ensures comfort throughout the day.</p></div>
                    </div>
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">Specification<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p><strong>Material:</strong> 100% Premium Cotton <br> <strong>Embroidery:</strong> Hand-stitched Chikankari <br> <strong>Fit:</strong> Regular <br> <strong>Sleeves:</strong> 3/4 Length</p></div>
                    </div>
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">Wash Care<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p>Hand wash cold separately. Use mild detergent. Do not bleach. Dry in shade. Iron on low heat.</p></div>
                    </div>
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">Returns and Exchange Policy<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p>Easy 7-day returns and exchanges. The product must be in its original condition with all tags intact. Please visit our returns center to initiate a request.</p></div>
                    </div>
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">Manufactured and Packaged By<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p>Mor Fashion Pvt. Ltd., Jubilee Hills, Hyderabad, Telangana, 500033. Country of Origin: India.</p></div>
                    </div>
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">Shipping Information<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p>Free shipping within Hyderabad. Standard shipping (5-7 business days) for other locations. Express shipping options are available at checkout.</p></div>
                    </div>
                    <div class="modern-accordion-item">
                        <button class="modern-accordion-header">For Complaints<i class="fas fa-plus"></i></button>
                        <div class="modern-accordion-content"><p>Contact our Customer Care Executive at: <a href="mailto:support@mor.com" style="color: #333;">support@mor.com</a> or call us at <a href="tel:+919885489448" style="color: #333;">+91-9885489448</a>.</p></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Customer Reviews Section -->
        <div class="modern-reviews-container animate-fade-in">
            <div class="reviews-section-header">
                <h2>Customer Reviews</h2>
                <button class="write-review-btn" id="write-review-btn"><i class="fas fa-pen"></i> Write a Review</button>
            </div>
            <div class="reviews-list" id="reviews-list">
                <!-- Customer reviews will be dynamically added here -->
            </div>
        </div>

        <!-- Related Products Section -->
        <section class="related-products-section animate-fade-in">
            <h2>You Might Also Like</h2>
            <div class="featured-scroll" id="related-products-container">
                <!-- Related products will be injected here by JS -->
            </div>
        </section>
    </main>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/919885489448" class="whatsapp-float" target="_blank" rel="noopener noreferrer" aria-label="Chat with us on WhatsApp">
        <i class="fab fa-whatsapp"></i>
        <span class="whatsapp-text">WhatsApp</span>
    </a>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast"></div>

    <!-- Component Placeholders for mor.js -->
    <div class="overlay"></div>
    <div id="login-modal" class="modal-overlay" style="display: none;">
        <div class="login-modal-content">
            <span class="modal-close login-modal-close">&times;</span>
            <h2 id="login-modal-title">Welcome Back</h2>
            <div class="login-toggle-options">
                <button class="login-toggle-btn active" data-method="email">Email</button>
                <button class="login-toggle-btn" data-method="phone">Phone</button>
            </div>
            <p id="login-modal-subtitle">Log in to access your account and favorites.</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="you@example.com" required>
                </div>
                <div class="form-group" id="mobile-number-group" style="display: none;">
                    <label for="mobile-number">Mobile Number</label>
                    <input type="tel" id="mobile-number" placeholder="10-digit mobile number" pattern="[0-9]{10}">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="••••••••" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
                <div class="form-group" id="forgot-password-group">
                    <a href="#" id="forgot-password-link">Forgot Password?</a>
                </div>
                <div class="form-group" id="confirm-password-group" style="display: none;">
                    <label for="confirm-password">Confirm Password</label>
                    <input type="password" id="confirm-password" placeholder="••••••••">
                    <i class="fas fa-eye toggle-password"></i>
                </div>
                <div class="form-group" id="otp-group" style="display: none;">
                    <label for="otp-input">Enter OTP</label>
                    <input type="text" id="otp-input" placeholder="6-digit OTP" pattern="[0-9]{6}">
                </div>
                <button type="submit" class="login-submit-btn" id="login-submit-btn">Log In</button>
            </form>
            <p class="create-account-link">
                <span id="toggle-view-text">Don't have an account? </span>
                <a href="#" id="toggle-view-link">Create your account</a>
            </p>
        </div>
    </div>
    <div id="cart-popup" class="cart-popup">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="close-cart-btn" aria-label="Close Cart"><i class="fas fa-times"></i></button>
        </div>
        <div class="cart-content">
            <div class="cart-empty"><i class="fas fa-shopping-bag"></i><p>Your cart is empty</p><button class="cta-btn continue-shopping-btn">Continue Shopping</button></div>
            <div class="cart-items" style="display: none;"></div>
        </div>
        <div class="cart-footer" style="display: none;">
            <div class="cart-subtotal"><span>Subtotal</span><span id="cart-subtotal-amount">₹0.00</span></div>
            <button class="cta-btn checkout-btn">Proceed to Checkout</button>
        </div>
    </div>
    <div id="favorites-popup" class="favorites-popup">
        <div class="favorites-header">
            <h3>Your Favorites</h3>
            <button class="close-favorites-btn" aria-label="Close Favorites"><i class="fas fa-times"></i></button>
        </div>
        <div class="favorites-content">
            <div class="favorites-empty">
                <i class="far fa-heart"></i>
                <p>You have no favorites yet</p>
                <button class="cta-btn start-browsing-btn">Start Browsing</button>
            </div>
            <div class="favorites-items" style="display: none;"></div>
        </div>
    </div>
    <div id="zoom-modal" class="zoom-modal">
        <span class="zoom-modal-close" id="zoom-modal-close">&times;</span>
        <div class="zoom-modal-content">
            <img src="" alt="Zoomed Product Image" id="zoomed-image" loading="lazy">
        </div>
    </div>
    <div id="review-modal" class="modal-overlay" style="display: none;">
        <div class="review-modal-content">
            <span class="modal-close review-modal-close">&times;</span>
            <h3>Write a Review</h3>
            <form id="review-form">
                <div class="form-group">
                    <label>Your Rating</label>
                    <div class="star-rating-input" id="star-rating-input">
                        <i class="far fa-star" data-value="1"></i><i class="far fa-star" data-value="2"></i><i class="far fa-star" data-value="3"></i><i class="far fa-star" data-value="4"></i><i class="far fa-star" data-value="5"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="review-text">Your Review</label>
                    <textarea id="review-text" rows="5" placeholder="Tell us what you think..."></textarea>
                </div>
                <button type="submit" class="cta-btn">Submit Review</button>
            </form>
        </div>
    </div>

    <!-- Login Required Modal -->
    <div id="login-required-modal" class="modal-overlay" style="display: none;">
        <div class="login-required-modal-content">
            <span class="modal-close login-required-modal-close">&times;</span>
            <h3>Login Required</h3>
            <p>You need to be logged in<br> to add an item in cart</p>
            <button class="cta-btn" id="login-now-btn">Login Now</button>
        </div>
    </div>

    <footer class="footer" id="contact">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Mor</h4>
                <p>Premium fashion for the modern woman. Discover elegance, embrace style, and express your unique personality with our curated collections.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <p><a href="index.html#home">Home</a></p>
                <p><a href="index.html#categories">Categories</a></p>
                <p><a href="index.html#collections">Collections</a></p>
                <p><a href="index.html#about">About Us</a></p>
            </div>
            <div class="footer-section">
                <h4>Customer Care</h4>
                <p><a href="#">Size Guide</a></p>
                <p><a href="#">Shipping Info</a></p>
                <p><a href="#">Returns & Exchanges</a></p>
                <p><a href="#">Contact Support</a></p>
            </div>
            <div class="footer-section">
                <h4>Connect</h4>
                <p><a href="#">Instagram</a></p>
                <p><a href="#">Facebook</a></p>
                <p><a href="#">Twitter</a></p>
                <p><a href="#">Newsletter</a></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Mor Fashion. All rights reserved. | <a href="privacy.html" style="color: inherit;">Privacy Policy</a> | <a href="terms.html" style="color: inherit;">Terms of Service</a></p>
        </div>
    </footer>

    <!-- You can include your footer here -->
    <script src="mor.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
             const allProducts = [
                { name: "Black Chikankari Kurti", price: "₹1,499", oldPrice: "₹1,999", imgSrc: "A10.jpg", pageUrl: "A10.html" },
                { name: "Stylish Rayon Kurti", price: "₹1,399", oldPrice: "₹1,799", imgSrc: "B11.jpg", pageUrl: "B11.html" },
                { name: "Elegant Georgette Kurti", price: "₹1,599", oldPrice: "₹2,199", imgSrc: "C10.jpg", pageUrl: "C10.html" },
                { name: "Classic Viscose Kurta", price: "₹1,899", oldPrice: "₹2,499", imgSrc: "D10.jpg", pageUrl: "D10.html" },
                { name: "Green Floral Kurti", price: "₹1,199", oldPrice: "₹1,599", imgSrc: "E10.jpg", pageUrl: "E10.html" },
                { name: "Red Printed Kurti", price: "₹1,299", oldPrice: "₹1,699", imgSrc: "F10.jpg", pageUrl: "F10.html" },
                { name: "Yellow Summer Kurti", price: "₹1,099", oldPrice: "₹1,499", imgSrc: "G10.jpg", pageUrl: "G10.html" },
                { name: "Blue Casual Kurti", price: "₹1,399", oldPrice: "₹1,899", imgSrc: "H10.jpg", pageUrl: "H10.html" },
                { name: "Navy Blue Kurti Set", price: "₹1,799", oldPrice: "₹2,399", imgSrc: "I10.jpg", pageUrl: "I10.html" },
                { name: "Maroon Velvet Kurti", price: "₹2,499", oldPrice: "₹3,199", imgSrc: "J10.jpg", pageUrl: "J10.html" },
                { name: "Light Green Kurti", price: "₹1,450", oldPrice: "₹1,950", imgSrc: "K10.jpg", pageUrl: "K10.html" },
                { name: "Purple Silk Kurti", price: "₹1,999", oldPrice: "₹2,599", imgSrc: "L10.jpg", pageUrl: "L10.html" }
            ];

            // --- Product Page Gallery ---
            const sliderTrack = document.getElementById('gallery-slider-track');
            const dotsContainer = document.getElementById('gallery-dots-container');
            const prevBtn = document.getElementById('gallery-prev');
            const nextBtn = document.getElementById('gallery-next');

            const galleryImages = ["A10.jpg", "A11.jpg", "A12.jpg"];
            let currentImageIndex = 0;
            
            // Create images and dots
            galleryImages.forEach((src, index) => {
                // Create image element
                const img = document.createElement('img');
                img.src = src;
                img.alt = `Product image ${index + 1}`;
                img.loading = 'lazy';
                sliderTrack.appendChild(img);

                // Create dot element
                const dot = document.createElement('span');
                dot.classList.add('gallery-dot');
                if (index === 0) dot.classList.add('active');
                dot.dataset.index = index;
                dotsContainer.appendChild(dot);
            });

            const dots = document.querySelectorAll('.gallery-dot');

            function showImage(index) {
                // Update main image
                sliderTrack.style.transform = `translateX(-${index * 100}%)`;
                 // Update active dot
                dots.forEach(d => d.classList.remove('active'));
                dots[index].classList.add('active');

                currentImageIndex = index;
            }

            // Event Listeners for arrows
            nextBtn.addEventListener('click', () => {
                const nextIndex = (currentImageIndex + 1) % galleryImages.length;
                showImage(nextIndex);
            });

            prevBtn.addEventListener('click', () => {
                const prevIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
                showImage(prevIndex);
            });

            // Event Listener for dots
            dotsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('gallery-dot')) {
                    const index = parseInt(e.target.dataset.index);
                    showImage(index);
                }
            });

            // Hide arrows if only one image
            if (galleryImages.length <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            }

             // --- Click-to-Zoom Image Modal ---
            const zoomModal = document.getElementById('zoom-modal');
            const zoomIcon = document.getElementById('zoom-icon');
            const zoomedImage = document.getElementById('zoomed-image');
            const closeModal = document.getElementById('zoom-modal-close');

            const openZoomModal = (src) => {
                zoomedImage.src = src;
                zoomModal.classList.add('show');
            };

            const closeZoomModal = () => {
                zoomModal.classList.remove('show');
            }

            zoomIcon.addEventListener('click', () => {
                openZoomModal(galleryImages[currentImageIndex]);
            });

            closeModal.addEventListener('click', closeZoomModal);
            zoomModal.addEventListener('click', (e) => {
                if (e.target === zoomModal) { // Close if clicking on the background
                    closeZoomModal();
                }
            });

            // Add mouse move event for zoom effect
            zoomedImage.addEventListener('mousemove', (e) => {
                const rect = zoomedImage.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const xPercent = (x / rect.width) * 100;
                const yPercent = (y / rect.height) * 100;

                zoomedImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
                zoomedImage.style.transform = 'scale(2)'; // Zoom level
            });
            zoomedImage.addEventListener('mouseleave', () => {
                zoomedImage.style.transform = 'scale(1)';
                zoomedImage.style.transformOrigin = 'center center';
            });

            // Add touch events for mobile zoom
            zoomedImage.addEventListener('touchmove', (e) => {
                e.preventDefault(); // Prevent page from scrolling
                const rect = zoomedImage.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;

                // Ensure the touch is within the image bounds
                if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                    const xPercent = (x / rect.width) * 100;
                    const yPercent = (y / rect.height) * 100;

                    zoomedImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
                    zoomedImage.style.transform = 'scale(2)';
                }
            });

            zoomedImage.addEventListener('touchend', () => {
                zoomedImage.style.transform = 'scale(1)';
                zoomedImage.style.transformOrigin = 'center center';
            });

            // --- Size Selector ---
            const sizeSelector = document.getElementById('size-selector');
            sizeSelector.addEventListener('click', (e) => {
                if (e.target.classList.contains('size-btn')) {
                    sizeSelector.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });

            // --- Quantity Counter ---
            const quantityValue = document.querySelector('.quantity-value');
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    let currentQty = parseInt(quantityValue.textContent);
                    if (btn.dataset.action === 'increase') {
                        currentQty++;
                    } else if (currentQty > 1) {
                        currentQty--;
                    }
                    quantityValue.textContent = currentQty;
                });
            });

            // --- Add to Cart ---
            // This part requires your main mor.js cart functions.
            // For a multi-page app, you'd typically save the cart to localStorage
            // so it persists across pages. This is a simplified example.
            document.getElementById('add-to-cart-btn').addEventListener('click', (e) => {
                let imgSrc = galleryImages[0];
                if (imgSrc.includes('/')) imgSrc = imgSrc.split('/').pop();
                const product = {
                    name: document.getElementById('product-name').textContent,
                    price: document.getElementById('product-price').textContent,
                    size: sizeSelector.querySelector('.size-btn.active').textContent,
                    imgSrc: imgSrc,
                    quantity: parseInt(quantityValue.textContent)
                };
                window.flyToCart(e.target, product);
            });
 
            window.addEventListener('load', () => {

            // --- Related Products ---
            const relatedProductsContainer = document.getElementById('related-products-container');
            const currentProductName = document.getElementById('product-name').textContent;

            const relatedProducts = allProducts
                .filter(p => p.name !== currentProductName) // Exclude the current product
                .sort(() => 0.5 - Math.random()) // Shuffle the array
                .slice(0, 4); // Get the first 4 random products

            relatedProducts.forEach(product => {
                const productCardHTML = `
                    <div class="product-item-wrapper">
                        <a href="${product.pageUrl}" style="text-decoration: none; color: inherit;">
                            <div class="product-card" data-name="${product.name}" data-price="${product.price}" data-page-url="${product.pageUrl}">
                                <div class="product-image-container">
                                    <img src="${product.imgSrc}" alt="${product.name}" loading="lazy">
                                    <div class="product-favorite-icon" data-name="${product.name}" data-price="${product.price}" data-img-src="${product.imgSrc}">
                                        <i class="far fa-heart"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="product-info">
                                <h4 class="product-name">${product.name}</h4>
                                <p class="product-price">${product.price}</p>
                            </div>
                        </a>
                    </div>
                `;
                relatedProductsContainer.innerHTML += productCardHTML;
            });
        });

            // --- Product Description Accordion ---
            document.querySelectorAll('.modern-accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('i');
                    const item = header.parentElement;

                    item.classList.toggle('active');

                    if (item.classList.contains('active')) {
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.classList.remove('fa-plus');
                        icon.classList.add('fa-minus');
                    } else {
                        content.style.maxHeight = null;
                        icon.classList.remove('fa-minus');
                        icon.classList.add('fa-plus');
                    }
                });
            });

            // --- Review Modal ---
            const reviewModal = document.getElementById('review-modal');
            if (reviewModal) {
                const openReviewBtn = document.getElementById('write-review-btn');
                const closeReviewBtn = reviewModal.querySelector('.review-modal-close');
                const starRatingContainer = document.getElementById('star-rating-input');
                const stars = starRatingContainer.querySelectorAll('.fa-star');
                let currentRating = 0;

                const openReviewModal = () => {
                    // Check for a logged-in user. This function is in mor.js
                    if (window.isUserLoggedIn && window.isUserLoggedIn()) {
                        reviewModal.style.display = 'flex';
                        setTimeout(() => reviewModal.classList.add('show'), 10);
                    } else {
                        window.openLoginRequiredModal(); // Use global function
                    }
                };

                const closeReviewModal = () => {
                    reviewModal.classList.remove('show');
                    setTimeout(() => reviewModal.style.display = 'none', 300);
                };

                openReviewBtn.addEventListener('click', openReviewModal);
                closeReviewBtn.addEventListener('click', closeReviewModal);
                reviewModal.addEventListener('click', (e) => {
                    if (e.target === reviewModal) closeReviewModal();
                });

                // Star rating logic
                stars.forEach(star => {
                    star.addEventListener('mouseover', () => {
                        const rating = parseInt(star.dataset.value);
                        stars.forEach((s, i) => {
                            s.className = i < rating ? 'fas fa-star' : 'far fa-star';
                        });
                    });

                    star.addEventListener('mouseout', () => {
                        stars.forEach((s, i) => {
                            s.className = i < currentRating ? 'fas fa-star selected' : 'far fa-star';
                        });
                    });

                    star.addEventListener('click', () => {
                        currentRating = parseInt(star.dataset.value);
                    });
                });

                document.getElementById('review-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    window.showToast('Thank you for your review!', 'fa-check-circle');
                    closeReviewModal();
                });
            }
        }); // End of DOMContentLoaded
    </script>
